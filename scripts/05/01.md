# Day 5

## One-to-Many
- We want to add comments
- Naive approaches to storing comments: serialized array, comments columns
- Talk about relational databases
- Quickly discuss NoSQL
- One-to-many
- Write migration
    `artisan make:model Comment -m`
- Discuss foreign keys
    ```php
    // create the article_id column
    $table->bigInteger("article_id")->unsigned();

    // set up the foreign key constraint
    $table->foreign("article_id")->references("id")->on("articles")->onDelete("cascade");
    ```
- Add Eloquent relationships
    On articles:
    ```php
    // plural, as an article can have multiple comments
    public function comments() {
        // use hasMany relationship method
    return $this->hasMany(Comment::class); }
    ```

    On comments:
    ```php
    // setup the other side of the relationship
    // use singular, as a comment only has one article
    public function article()
    {
        // a comment belongs to an article
        return $this->belongsTo(Article::class);
    }
    ```
- Demonstrate adding comment with `tinker`:
    ```php
    $comment->article_id = 1;
    $comment->save();
    ```
    Then to show have access to the article object from the comment:
    ```php
    $article = $comment->article;
    $article->title;
    ```
- Need to add `POST /articles/<id>/comments` and `GET /articles/<id>/comments`
- Add a `Comments` controller
- Add `use App\Article` and `use App\Comment`
- `GET` request: just return `$article->comments` property
- `POST`: get request data, create new comment, `$article->comments()->save($comment)`
- Need to add `$fillable` to `Comment`
- Add validation
- Add resource
